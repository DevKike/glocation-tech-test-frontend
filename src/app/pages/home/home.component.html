<app-loading
  [visible]="isLoading"
  message="Loading"
  [overlay]="true"
  strokeWidth="4"
></app-loading>

<app-header title="Project Management System"></app-header>

<div class="home-container">
  <div class="insights-section" *ngIf="feedback">
    <div class="insights-card">
      <div class="insights-header">
        <div class="insights-icon">
          <i class="pi pi-sparkles"></i>
        </div>
        <div class="insights-title">
          <h3>AI-Powered Insights</h3>
          <p class="insights-subtitle">
            Smart analysis of your project portfolio
          </p>
        </div>
      </div>
      <p class="insights-summary">{{ feedback.summary }}</p>
      <div class="insights-stats">
        <div class="stat-item">
          <div class="stat-icon">
            <i class="pi pi-briefcase"></i>
          </div>
          <span class="stat-value">{{ feedback.stats.totalProjects }}</span>
          <span class="stat-label">Total Projects</span>
        </div>
        <div class="stat-item success">
          <div class="stat-icon">
            <i class="pi pi-check-circle"></i>
          </div>
          <span class="stat-value"
            >{{ feedback.stats.finishedPercentage }}%</span
          >
          <span class="stat-label">Completed</span>
        </div>
        <div class="stat-item warning">
          <div class="stat-icon">
            <i class="pi pi-clock"></i>
          </div>
          <span class="stat-value"
            >{{ feedback.stats.inProgressPercentage }}%</span
          >
          <span class="stat-label">In Progress</span>
        </div>
      </div>
    </div>
  </div>

  <div class="charts-section" *ngIf="feedback">
    <div class="charts-grid">
      <app-card
        header="Status Distribution"
        subheader="Overview of project completion"
        width="100%"
        height="auto"
        padding="1.5rem"
      >
        <app-chart
          type="doughnut"
          [data]="statusChartData"
          height="350px"
        ></app-chart>
      </app-card>

      <app-card
        header="Projects by Status"
        subheader="Number of projects in each stage"
        width="100%"
        height="auto"
        padding="1.5rem"
      >
        <app-chart
          type="bar"
          [data]="projectsOverTimeData"
          height="350px"
        ></app-chart>
      </app-card>

      <app-card
        header="Completion Trend"
        subheader="Project completion over time"
        width="100%"
        height="auto"
        padding="1.5rem"
      >
        <app-chart
          type="line"
          [data]="completionRateData"
          height="350px"
        ></app-chart>
      </app-card>
    </div>
  </div>

  <app-card
    header="All Projects"
    subheader="Manage and track all your projects in one place"
    width="100%"
    height="auto"
    padding="0"
  >
    <div class="table-content">
      <div class="table-header">
        <div class="table-info">
          <h2>Projects List</h2>
          <p class="table-count">{{ projects.length }} total projects</p>
        </div>
        <app-button
          label="New Project"
          icon="pi pi-plus"
          severity="success"
          (onClick)="openCreateDialog()"
        ></app-button>
      </div>

      <app-table
        [projects]="projects"
        (editProject)="handleEdit($event)"
        (deleteProject)="handleDelete($event)"
      ></app-table>
    </div>
  </app-card>
</div>

<app-form-dialog
  [(visible)]="displayCreateDialog"
  [mode]="'create'"
  (onSave)="handleCreate($event)"
  (onCancel)="handleCancelCreate()"
></app-form-dialog>

<app-form-dialog
  [(visible)]="displayEditDialog"
  [mode]="'edit'"
  [project]="selectedProject"
  (onSave)="handleUpdate($event)"
  (onCancel)="handleCancelEdit()"
></app-form-dialog>

<app-confirm-dialog></app-confirm-dialog>
<app-toast></app-toast>
