<p-dialog
  [(visible)]="visible"
  [header]="dialogHeader"
  [modal]="true"
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false"
  (onHide)="onHide()"
>
  <form [formGroup]="projectForm" class="form-container">
    <div class="field">
      <label for="name">Project Name *</label>
      <input
        id="name"
        type="text"
        pInputText
        formControlName="name"
        placeholder="Enter project name (min. 5 characters)"
        class="w-full"
        [class.p-invalid]="
          projectForm.get('name')?.invalid && projectForm.get('name')?.touched
        "
      />
      <small class="p-error" *ngIf="getErrorMessage('name')">
        {{ getErrorMessage("name") }}
      </small>
    </div>

    <div class="field">
      <label for="description">Description *</label>
      <textarea
        id="description"
        rows="4"
        pInputTextarea
        formControlName="description"
        placeholder="Enter project description (min. 5 characters)"
        class="w-full"
        [class.p-invalid]="
          projectForm.get('description')?.invalid &&
          projectForm.get('description')?.touched
        "
      ></textarea>
      <small class="p-error" *ngIf="getErrorMessage('description')">
        {{ getErrorMessage("description") }}
      </small>
    </div>

    <div class="field" *ngIf="mode === 'edit'">
      <label for="status">Status</label>
      <p-dropdown
        id="status"
        formControlName="status"
        [options]="statusOptions"
        optionLabel="label"
        optionValue="value"
        [disabled]="!canChangeStatus"
        placeholder="Select a status"
        [style]="{ width: '100%' }"
      ></p-dropdown>
      <small class="status-hint" *ngIf="!canChangeStatus">
        <i class="pi pi-info-circle"></i>
        This project is already finished and cannot be changed.
      </small>
      <small class="status-hint" *ngIf="canChangeStatus">
        <i class="pi pi-info-circle"></i>
        You can only mark this project as finished.
      </small>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <app-button
      label="Cancel"
      icon="pi pi-times"
      severity="secondary"
      [text]="true"
      (onClick)="cancel()"
    ></app-button>
    <app-button
      [label]="mode === 'create' ? 'Create' : 'Update'"
      icon="pi pi-check"
      severity="primary"
      [disabled]="!isFormValid"
      (onClick)="save()"
    ></app-button>
  </ng-template>
</p-dialog>
